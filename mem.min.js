!function(a){function b(){function a(a,b){return Array.prototype.slice.call(a,b)}var b={on:function(a,c,d,e){var f=b._forSubject(a),g=!f.callbacks.some(function(a){return a.eventName===c});f.callbacks.push({eventName:c,action:d,iterations:e&&(e.once&&1||e.iterations)||null,context:e&&e.context,args:e&&e.args}),g&&c!==b._eventName_new_event_tracked&&b.trigger(a,b._eventName_new_event_tracked,c)},off:function(a,c,d){var e={};b._subjects=b._subjects.filter(function(f){if(a&&f.subject!==a)return!0;var g={};return f.callbacks=f.callbacks.filter(function(a){return g[a.eventName]=(g[a.eventName]||0)+1,c&&a.eventName!==c?!0:d&&a.action!==d?!0:(g[a.eventName]-=1,e[a.eventName]=!0,!1)}),Object.keys(e).forEach(function(a){g[a]||b.trigger(f.subject,b._eventName_event_untracked,a)}),!!f.callbacks.length})},trigger:function(c,d){var e=a(arguments,2),f=!1,g=b._forSubject(c),h=[];if(g.running&&~g.running.indexOf(d)){var i=new Error(b._msg_recusions_not_allowed+": "+d+" on "+c.toString());throw i.subject=c,i.eventName=d,i.args=e,i}if(g.running=g.running||[],g.running.push(d),g.callbacks.forEach(function(a){if(a.eventName===d){f=!0,a.iterations&&(a.iterations-=1);var g=(a.args||[]).concat(e);try{h.push(a.action.apply(a.context||c,g))}catch(i){c!==b||d!==b._eventName_error?b.trigger(b,b._eventName_error,c,d,i,a.context,a.action,g):b._fatal(b._msg_error_listener_error,c,d,i,a.context,a.action,g)}}}),g.running=g.running.filter(function(a){return d!==a}),f){var j=!1;g.callbacks=g.callbacks.filter(function(a){return a.eventName!==d?!0:0!==a.iterations?(j=!0,!0):!1}),g.callbacks.length||(b._subjects=b._subjects.filter(function(a){return a.subject!==c})),j||b.trigger(c,b._eventName_event_untracked,d)}else c===b&&d===b._eventName_error?b._fatal(b._msg_error_uncaught,e[0],e[1],e[2],e[3],e[4],e[5]):d!==b._eventName_orphan&&b.trigger(b,b._eventName_orphan,c,d,e);return h},_eventName_new_event_tracked:"event_tracked",_eventName_event_untracked:"event_untracked",_eventName_orphan:"orphan_event",_eventName_error:"error",_msg_error_uncaught:"mem error event uncaught",_msg_error_listener_error:"mem error event listener error",_msg_recusions_not_allowed:"mem event recursion not allowed",_subjects:[],_forSubject:function(a){var c;return b._subjects.some(function(b){return b.subject!==a?!1:(c=b,!0)}),c||(c={subject:a,callbacks:[]},b._subjects.push(c)),c},_fatal:function(a,b,c,d,e,f,g){var h=new Error(a+": "+d.message);h.subject=b,h.eventName=c,h.error=d,h.context=e,h.action=f,h.args=g,setTimeout(function(){throw h},0)}};return b}"object"==typeof module&&module.exports?module.exports=b():"function"==typeof define&&define.amd?define("mem",[],b):a.mem=b()}(this);