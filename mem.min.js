!function(a){function b(){function a(a,b){return Array.prototype.slice.call(a,b)}var b={on:function(a,b,c,d){this._forSubject(a).callbacks.push({eventName:b,action:c,once:d&&d.once,context:d&&d.context,args:d&&d.args})},off:function(a,b,c){this._callbacks=this._callbacks.filter(function(d){return a&&d.subject!==a?!0:(d.callbacks=d.callbacks.filter(function(a){return b&&a.eventName!==b?!0:c&&a.action!==c?!0:!1}),!!d.callbacks.length)})},trigger:function(c,d){var e=a(arguments,2),f=!1,g=this._forSubject(c),h=[];if(g.running&&~g.running.indexOf(d)){var i=new Error(b._msg_recusions_not_allowed+": "+d+" on "+c.toString());throw i.subject=c,i.eventName=d,i.args=e,i}return g.running=g.running||[],g.running.push(d),g.callbacks=g.callbacks.filter(function(a){if(a.eventName!==d)return!0;f=!0;var g=!a.once,i=(a.args||[]).concat(e);try{h.push(a.action.apply(a.context||c,i))}catch(j){c!==b||d!==b._error_eventName?b.trigger(b,b._error_eventName,c,d,j,a.context,a.action,i):b._fatal(b._msg_error_listener_error,c,d,j,a.context,a.action,i)}return g}),g.running=g.running.filter(function(a){return d!==a}),g.callbacks.length||(this._callbacks=this._callbacks.filter(function(a){return a.subject===c?!1:!0})),c!==b||d!==b._error_eventName||f||b._fatal(b._msg_error_uncaught,arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]),h},_error_eventName:"error",_msg_error_uncaught:"mem error event uncaught",_msg_error_listener_error:"mem error event listener error",_msg_recusions_not_allowed:"mem event recursion not allowed",_callbacks:[],_forSubject:function(a){var b;return this._callbacks.some(function(c){return c.subject!==a?!1:(b=c,!0)}),b||(b={subject:a,callbacks:[]},this._callbacks.push(b)),b},_fatal:function(a,b,c,d,e,f,g){var h=new Error(a+": "+d.message);h.subject=b,h.eventName=c,h.error=d,h.context=e,h.action=f,h.args=g,setTimeout(function(){throw h},0)}};return b}"function"==typeof define&&define.amd?define("mem",[],b):a.mem=b()}(this);